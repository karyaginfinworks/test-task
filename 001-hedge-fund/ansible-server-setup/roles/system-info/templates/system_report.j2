# System Information Report
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Host: {{ inventory_hostname }}

================================================================================
                            SYSTEM SUMMARY
================================================================================

Hostname: {{ ansible_hostname }}
FQDN: {{ ansible_fqdn }}
Operating System: {{ ansible_distribution }} {{ ansible_distribution_version }}
Kernel: {{ ansible_kernel }}
Architecture: {{ ansible_architecture }}
Uptime: {{ ansible_uptime_seconds | int // 86400 }} days, {{ (ansible_uptime_seconds | int % 86400) // 3600 }} hours

{% if gather_cpu_info %}
================================================================================
                            CPU INFORMATION
================================================================================

CPU Model: {{ ansible_processor[2] if ansible_processor is defined and ansible_processor|length > 2 else 'Unknown' }}
CPU Cores: {{ ansible_processor_cores }}
CPU Count: {{ ansible_processor_count }}
CPU Threads: {{ ansible_processor_threads_per_core }}
CPU VCPUs: {{ ansible_processor_vcpus }}

{% if cpu_info is defined %}
{{ cpu_info.stdout | replace('\t', '  ') }}
{% endif %}

{% if check_hyperthreading and ansible_processor[0] is search("Intel") %}
{% if ht_info is defined %}
Intel Hyper-Threading Status:
{{ ht_info.stdout }}
{% endif %}
{% endif %}

{% if check_amd_smt and ansible_processor[0] is search("AMD") %}
{% if smt_info is defined %}
AMD SMT Status:
{{ smt_info.stdout }}
{% endif %}
{% endif %}

{% if check_cpu_frequency and cpu_frequency_info is defined %}
CPU Frequency Information:
{{ cpu_frequency_info.stdout | replace('\t', '  ') }}
{% endif %}

{% if check_cpu_governor and cpu_governor_info is defined %}
CPU Governor: {{ cpu_governor_info.stdout }}
{% endif %}
{% endif %}

{% if gather_memory_info %}
================================================================================
                           MEMORY INFORMATION
================================================================================

Total Memory: {{ ansible_memtotal_mb }} MB ({{ (ansible_memtotal_mb / 1024) | round(2) }} GB)
Free Memory: {{ ansible_memfree_mb }} MB
Available Memory: {{ ansible_memory_mb.nocache.free | default('N/A') }} MB
Used Memory: {{ ansible_memory_mb.real.used | default('N/A') }} MB
Swap Total: {{ ansible_swaptotal_mb }} MB
Swap Free: {{ ansible_swapfree_mb }} MB

{% if memory_detailed_info is defined %}
Detailed Memory Information:
{{ memory_detailed_info.stdout }}
{% endif %}
{% endif %}

{% if gather_disk_info %}
================================================================================
                            DISK INFORMATION
================================================================================

{% for mount in ansible_mounts %}
{{ mount.mount }}: {{ mount.size_total | filesizeformat }} total, {{ mount.size_available | filesizeformat }} available ({{ mount.fstype }})
{% endfor %}

{% if disk_detailed_info is defined %}
Detailed Disk Information:
{{ disk_detailed_info.stdout }}
{% endif %}
{% endif %}

{% if gather_network_info %}
================================================================================
                          NETWORK INFORMATION
================================================================================

{% for interface, details in ansible_interfaces | map('extract', hostvars[inventory_hostname], 'ansible_') | list | zip(ansible_interfaces) %}
{% set interface_name = details %}
{% set interface_data = hostvars[inventory_hostname]['ansible_' + interface_name] %}
{% if interface_data is defined and interface_data.get('ipv4') %}
Interface: {{ interface_name }}
  IP Address: {{ interface_data.ipv4.address }}
  Netmask: {{ interface_data.ipv4.netmask }}
  MAC Address: {{ interface_data.macaddress | default('N/A') }}
  MTU: {{ interface_data.mtu | default('N/A') }}
  State: {{ interface_data.active | default('N/A') }}
{% endif %}
{% endfor %}

Default Gateway: {{ ansible_default_ipv4.gateway | default('N/A') }}
DNS Servers: {{ ansible_dns.nameservers | join(', ') if ansible_dns.nameservers is defined else 'N/A' }}
{% endif %}

{% if gather_kernel_info %}
================================================================================
                           KERNEL INFORMATION
================================================================================

Kernel Version: {{ ansible_kernel }}
Kernel Release: {{ ansible_kernel_version }}

{% if kernel_cmdline is defined %}
Kernel Command Line:
{{ kernel_cmdline.stdout }}
{% endif %}

{% if kernel_modules is defined %}
Loaded Modules (top 20):
{{ kernel_modules.stdout }}
{% endif %}
{% endif %}

{% if gather_virtualization_info %}
================================================================================
                        VIRTUALIZATION INFORMATION
================================================================================

Virtualization Type: {{ ansible_virtualization_type | default('Physical') }}
Virtualization Role: {{ ansible_virtualization_role | default('N/A') }}

{% if virtualization_details is defined %}
Virtualization Details:
{{ virtualization_details.stdout }}
{% endif %}
{% endif %}

{% if check_security_features %}
================================================================================
                          SECURITY INFORMATION
================================================================================

{% if security_mitigations is defined %}
Security Mitigations:
{{ security_mitigations.stdout | default('No specific mitigations found') }}
{% endif %}

{% if vulnerability_info is defined %}
CPU Vulnerabilities:
{% for vuln_name, vuln_data in vulnerability_info.items() %}
{{ vuln_name }}: {{ vuln_data.stdout | default('Unknown') }}
{% endfor %}
{% endif %}
{% endif %}

{% if check_hardware_info %}
================================================================================
                          HARDWARE INFORMATION
================================================================================

{% if hardware_system_info is defined %}
System Information:
{{ hardware_system_info.stdout | replace('\t', '  ') }}
{% endif %}

{% if check_bios_info and bios_info is defined %}
BIOS Information:
{{ bios_info.stdout | replace('\t', '  ') }}
{% endif %}

{% if check_pci_devices and pci_info is defined %}
PCI Devices:
{{ pci_info.stdout | replace('\t', '  ') }}
{% endif %}
{% endif %}

================================================================================
                              ANSIBLE FACTS
================================================================================

{% if include_ansible_facts %}
Ansible Version: {{ ansible_version.full }}
Python Version: {{ ansible_python_version }}
Gather Subset: {{ ansible_gather_subset | join(', ') }}
{% endif %}

Report Generated: {{ ansible_date_time.iso8601 }}
Report Format: {{ report_format }}
Detailed Report: {{ detailed_report }}

================================================================================
                                END OF REPORT
================================================================================
